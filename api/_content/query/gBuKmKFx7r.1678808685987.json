{"_path":"/migration/plugins-and-middleware","_dir":"migration","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"Plugins and Middleware","description":"","body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"plugins-and-middleware"},"children":[{"type":"text","value":"Plugins and Middleware"}]},{"type":"element","tag":"h2","props":{"id":"plugins"},"children":[{"type":"text","value":"Plugins"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Plugins now have a different format, and take only one argument ("},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nuxtApp"}]},{"type":"text","value":"). Read more in "},{"type":"element","tag":"a","props":{"href":"/docs/guide/directory-structure/plugins"},"children":[{"type":"text","value":"the docs"}]},{"type":"text","value":"."}]},{"type":"element","tag":"code-group","props":{},"children":[{"type":"element","tag":"code","props":{"code":"export default (ctx, inject) => {\r\n  inject('injected', () => 'my injected function')\r\n})\n","filename":"Nuxt 2","language":"js","meta":"[Nuxt 2]"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-9514dc"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"class":"ct-05ef3c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9514dc"},"children":[{"type":"text","value":"default"}]},{"type":"element","tag":"span","props":{"class":"ct-05ef3c"},"children":[{"type":"text","value":" (ctx, inject) "}]},{"type":"element","tag":"span","props":{"class":"ct-9514dc"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-05ef3c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":"{"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-8ddf24"},"children":[{"type":"text","value":"inject"}]},{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-d8bebf"},"children":[{"type":"text","value":"'injected'"}]},{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":", () "}]},{"type":"element","tag":"span","props":{"class":"ct-9514dc"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d8bebf"},"children":[{"type":"text","value":"'my injected function'"}]},{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":"}"}]},{"type":"element","tag":"span","props":{"class":"ct-05ef3c"},"children":[{"type":"text","value":")"}]}]}]}]}]},{"type":"element","tag":"code","props":{"code":"export default defineNuxtPlugin(nuxtApp => {\r\n  // now available on `nuxtApp.$injected`\r\n  nuxtApp.provide('injected', () => 'my injected function')\r\n\r\n  // You can alternatively use this format, which comes with automatic type support\r\n  return {\r\n    provide: {\r\n      injected: () => 'my injected function'\r\n    }\r\n  }\r\n})\n","filename":"Nuxt 3","language":"ts","meta":"[Nuxt 3]"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-9514dc"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"class":"ct-05ef3c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9514dc"},"children":[{"type":"text","value":"default"}]},{"type":"element","tag":"span","props":{"class":"ct-05ef3c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8ddf24"},"children":[{"type":"text","value":"defineNuxtPlugin"}]},{"type":"element","tag":"span","props":{"class":"ct-05ef3c"},"children":[{"type":"text","value":"(nuxtApp "}]},{"type":"element","tag":"span","props":{"class":"ct-9514dc"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-05ef3c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":"{"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-7a166e"},"children":[{"type":"text","value":"// now available on `nuxtApp.$injected`"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":"  nuxtApp."}]},{"type":"element","tag":"span","props":{"class":"ct-8ddf24"},"children":[{"type":"text","value":"provide"}]},{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-d8bebf"},"children":[{"type":"text","value":"'injected'"}]},{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":", () "}]},{"type":"element","tag":"span","props":{"class":"ct-9514dc"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d8bebf"},"children":[{"type":"text","value":"'my injected function'"}]},{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-7a166e"},"children":[{"type":"text","value":"// You can alternatively use this format, which comes with automatic type support"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-9514dc"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":" {"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":"    provide: {"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-8ddf24"},"children":[{"type":"text","value":"injected"}]},{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":": () "}]},{"type":"element","tag":"span","props":{"class":"ct-9514dc"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d8bebf"},"children":[{"type":"text","value":"'my injected function'"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":"    }"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":"  }"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":"}"}]},{"type":"element","tag":"span","props":{"class":"ct-05ef3c"},"children":[{"type":"text","value":")"}]}]}]}]}]}]},{"type":"element","tag":"alert","props":{"icon":"ðŸ‘‰"},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can read more about the format of "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nuxtApp"}]},{"type":"text","value":" in "},{"type":"element","tag":"a","props":{"href":"/docs/api/composables/use-nuxt-app"},"children":[{"type":"text","value":"the docs"}]},{"type":"text","value":"."}]}]},{"type":"element","tag":"h3","props":{"id":"migration"},"children":[{"type":"text","value":"Migration"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Migrate your plugins to use the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"defineNuxtPlugin"}]},{"type":"text","value":" helper function."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Remove any entries in your "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nuxt.config"}]},{"type":"text","value":" plugins array that are located in your "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"plugins/"}]},{"type":"text","value":" folder. All files in this directory at the top level (and any index files in any subdirectories) will be automatically registered. Instead of setting "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"mode"}]},{"type":"text","value":" to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"client"}]},{"type":"text","value":" or "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"server"}]},{"type":"text","value":", you can indicate this in the file name. For example, "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"~/plugins/my-plugin.client.ts"}]},{"type":"text","value":" will only be loaded on client-side."}]}]},{"type":"element","tag":"h2","props":{"id":"route-middleware"},"children":[{"type":"text","value":"Route Middleware"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Route middleware has a different format."}]},{"type":"element","tag":"code-group","props":{},"children":[{"type":"element","tag":"code","props":{"code":"export default function ({ store, redirect }) {\r\n  // If the user is not authenticated\r\n  if (!store.state.authenticated) {\r\n    return redirect('/login')\r\n  }\r\n}\n","filename":"Nuxt 2","language":"js","meta":"[Nuxt 2]"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-9514dc"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"class":"ct-05ef3c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9514dc"},"children":[{"type":"text","value":"default"}]},{"type":"element","tag":"span","props":{"class":"ct-05ef3c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9514dc"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-05ef3c"},"children":[{"type":"text","value":" ({ store, redirect }) "}]},{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":"{"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-7a166e"},"children":[{"type":"text","value":"// If the user is not authenticated"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-9514dc"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-9514dc"},"children":[{"type":"text","value":"!"}]},{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":"store.state.authenticated) {"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-9514dc"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8ddf24"},"children":[{"type":"text","value":"redirect"}]},{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-d8bebf"},"children":[{"type":"text","value":"'/login'"}]},{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":"  }"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"code","props":{"code":"export default defineNuxtRouteMiddleware((to, from) => {\r\n  const auth = useState('auth')\r\n  if (!auth.value.authenticated) {\r\n    return navigateTo('/login')\r\n  }\r\n})\n","filename":"Nuxt 3","language":"ts","meta":"[Nuxt 3]"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-9514dc"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"class":"ct-05ef3c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9514dc"},"children":[{"type":"text","value":"default"}]},{"type":"element","tag":"span","props":{"class":"ct-05ef3c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8ddf24"},"children":[{"type":"text","value":"defineNuxtRouteMiddleware"}]},{"type":"element","tag":"span","props":{"class":"ct-05ef3c"},"children":[{"type":"text","value":"((to, from) "}]},{"type":"element","tag":"span","props":{"class":"ct-9514dc"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-05ef3c"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":"{"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-9514dc"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-df9916"},"children":[{"type":"text","value":"auth"}]},{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9514dc"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8ddf24"},"children":[{"type":"text","value":"useState"}]},{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-d8bebf"},"children":[{"type":"text","value":"'auth'"}]},{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-9514dc"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-9514dc"},"children":[{"type":"text","value":"!"}]},{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":"auth.value.authenticated) {"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-9514dc"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8ddf24"},"children":[{"type":"text","value":"navigateTo"}]},{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-d8bebf"},"children":[{"type":"text","value":"'/login'"}]},{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":"  }"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ba1436"},"children":[{"type":"text","value":"}"}]},{"type":"element","tag":"span","props":{"class":"ct-05ef3c"},"children":[{"type":"text","value":")"}]}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Much like Nuxt 2, route middleware placed in your "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"~/middleware"}]},{"type":"text","value":" folder is automatically registered. You can then specify it by name in a component. However, this is done with "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"definePageMeta"}]},{"type":"text","value":" rather than as a component option."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"navigateTo"}]},{"type":"text","value":" is one of a number of route helper functions, which you can read more about in "},{"type":"element","tag":"a","props":{"href":"/docs/guide/directory-structure/middleware"},"children":[{"type":"text","value":"the documentation about route middleware"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h3","props":{"id":"migration-1"},"children":[{"type":"text","value":"Migration"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Migrate your route middleware to use the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"defineNuxtRouteMiddleware"}]},{"type":"text","value":" helper function."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Any global middleware (such as in your "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"nuxt.config"}]},{"type":"text","value":") can be placed in your "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"~/middleware"}]},{"type":"text","value":" folder with a "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":".global"}]},{"type":"text","value":" extension, for example "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"~/middleware/auth.global.ts"}]},{"type":"text","value":"."}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-df9916{color:#0550AE}\n.ct-7a166e{color:#6E7781}\n.ct-d8bebf{color:#0A3069}\n.ct-8ddf24{color:#8250DF}\n.ct-ba1436{color:#24292F}\n.ct-05ef3c{color:#953800}\n.ct-9514dc{color:#CF222E}\n.dark .ct-9514dc{color:#FF7B72}\n.dark .ct-05ef3c{color:#FFA657}\n.dark .ct-ba1436{color:#C9D1D9}\n.dark .ct-8ddf24{color:#D2A8FF}\n.dark .ct-d8bebf{color:#A5D6FF}\n.dark .ct-7a166e{color:#8B949E}\n.dark .ct-df9916{color:#79C0FF}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"plugins","depth":2,"text":"Plugins","children":[{"id":"migration","depth":3,"text":"Migration"}]},{"id":"route-middleware","depth":2,"text":"Route Middleware","children":[{"id":"migration-1","depth":3,"text":"Migration"}]}]}},"_type":"markdown","_id":"content:7.migration:5.plugins-and-middleware.md","_source":"content","_file":"7.migration/5.plugins-and-middleware.md","_extension":"md"}