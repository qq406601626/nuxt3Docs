---
navigation.icon: uil:channel
description: Nuxt provides composables to handle data fetching within your application.
---

# æ•°æ®è·å–

Nuxtæä¾›äº†useFetchã€useLazyFetchã€useAsyncDataå’ŒuseLazyAsyncDataæ¥å¤„ç†åº”ç”¨ç¨‹åºä¸­çš„æ•°æ®è·å–ã€‚

::alert{icon=ğŸ‘‰}
**`useFetch`, `useLazyFetch`, `useAsyncData` and `useLazyAsyncData` ä»…åœ¨ `setup` æˆ–è€… `Lifecycle Hooks`ä¸­ç”Ÿæ•ˆ**
::

## `useFetch`

åœ¨æ‚¨çš„é¡µé¢ã€ç»„ä»¶å’Œæ’ä»¶ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`useFetch`ä»ä»»ä½•URLæ™®éè·å–æ•°æ®ã€‚

è¯¥ç»„åˆå¼æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„åŒ…è£…å™¨ï¼Œå›´ç»•`useAsyncData`å’Œ`$fetch`ã€‚å®ƒåŸºäºURLå’Œè·å–é€‰é¡¹è‡ªåŠ¨ç”Ÿæˆå¯†é’¥ï¼ŒåŸºäºæœåŠ¡å™¨è·¯ç”±ä¸ºè¯·æ±‚URLæä¾›ç±»å‹æç¤ºï¼Œå¹¶æ¨æ–­APIå“åº”ç±»å‹ã€‚

::ReadMore{link="/docs/api/composables/use-fetch"}
::

### ç¤ºä¾‹

```vue [app.vue]
<script setup>
const { data: count } = await useFetch('/api/count')
</script>

<template>
  Page visits: {{ count }}
</template>
```

::LinkExample{link="/docs/examples/composables/use-fetch"}
::

## `useLazyFetch`

è¿™ä¸ªç»„åˆå¼çš„è¡Œä¸ºä¸è®¾ç½®`lazy: true`é€‰é¡¹çš„`useFetch`å®Œå…¨ç›¸åŒã€‚æ¢å¥è¯è¯´ï¼Œå¼‚æ­¥å‡½æ•°ä¸ä¼šé˜»å¡å¯¼èˆªã€‚è¿™æ„å‘³ç€æ‚¨éœ€è¦å¤„ç†æ•°æ®ä¸º`null`çš„æƒ…å†µï¼ˆæˆ–è€…æ‚¨åœ¨è‡ªå®šä¹‰`default`å·¥å‚å‡½æ•°ä¸­æä¾›çš„ä»»ä½•å€¼ï¼‰ã€‚

::ReadMore{link="/docs/api/composables/use-lazy-fetch"}
::

### ç¤ºä¾‹

```vue
<template>
  <!-- you will need to handle a loading state -->
  <div v-if="pending">
    Loading ...
  </div>
  <div v-else>
    <div v-for="post in posts">
      <!-- do something -->
    </div>
  </div>
</template>

<script setup>
const { pending, data: posts } = useLazyFetch('/api/posts')
watch(posts, (newPosts) => {
  // Because posts starts out null, you will not have access
  // to its contents immediately, but you can watch it.
})
</script>
```

## `useAsyncData`

åœ¨æ‚¨çš„é¡µé¢ã€ç»„ä»¶å’Œæ’ä»¶ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`useAsyncData`æ¥è·å–å¼‚æ­¥è§£æçš„æ•°æ®è®¿é—®æƒé™ã€‚

::alert
æ‚¨å¯èƒ½ä¼šé—®è‡ªå·±ï¼š`useFetch`å’Œ`useAsyncData`ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
<br/>
ç®€è€Œè¨€ä¹‹ï¼Œ`useFetch`æ¥æ”¶ä¸€ä¸ªURLå¹¶è·å–è¯¥æ•°æ®ï¼Œè€Œ`useAsyncData`å¯èƒ½å…·æœ‰æ›´å¤æ‚çš„é€»è¾‘ã€‚`useFetchï¼ˆurlï¼‰`å‡ ä¹ç­‰åŒäº`useAsyncDataï¼ˆurlï¼Œï¼ˆï¼‰=> $fetchï¼ˆurlï¼‰ï¼‰`-å®ƒæ˜¯æœ€å¸¸è§ç”¨ä¾‹çš„å¼€å‘è€…ä½“éªŒè¯­æ³•ç³–ã€‚
::

::ReadMore{link="/docs/api/composables/use-async-data"}
::

### ç¤ºä¾‹

```ts [server/api/count.ts]
let counter = 0
export default defineEventHandler(() => {
  counter++
  return counter
})
```

```vue [app.vue]
<script setup>
const { data } = await useAsyncData('count', () => $fetch('/api/count'))
</script>

<template>
  Page visits: {{ data }}
</template>
```

::LinkExample{link="/docs/examples/composables/use-async-data"}
::

## `useLazyAsyncData`

è¿™ä¸ªç»„åˆå¼çš„è¡Œä¸ºä¸è®¾ç½®`lazy: true`é€‰é¡¹çš„`useAsyncData`å®Œå…¨ç›¸åŒã€‚æ¢å¥è¯è¯´ï¼Œå¼‚æ­¥å‡½æ•°ä¸ä¼šé˜»å¡å¯¼èˆªã€‚è¿™æ„å‘³ç€æ‚¨éœ€è¦å¤„ç†æ•°æ®ä¸º`null`çš„æƒ…å†µï¼ˆæˆ–è€…æ‚¨åœ¨è‡ªå®šä¹‰`default`å·¥å‚å‡½æ•°ä¸­æä¾›çš„ä»»ä½•å€¼ï¼‰ã€‚

::ReadMore{link="/docs/api/composables/use-lazy-async-data"}
::

### ç¤ºä¾‹

```vue
<template>
  <div>
    {{ pending ? 'Loading' : count }}
  </div>
</template>

<script setup>
const { pending, data: count } = useLazyAsyncData('count', () => $fetch('/api/count'))
watch(count, (newCount) => {
  // Because count starts out null, you won't have access
  // to its contents immediately, but you can watch it.
})
</script>
```

## åˆ·æ–°æ•°æ®

æœ‰æ—¶åœ¨ç”¨æˆ·è®¿é—®é¡µé¢çš„è¿‡ç¨‹ä¸­ï¼Œæ‚¨å¯èƒ½éœ€è¦åˆ·æ–°ä»APIåŠ è½½çš„æ•°æ®ã€‚å¦‚æœç”¨æˆ·é€‰æ‹©åˆ†é¡µã€è¿‡æ»¤ç»“æœã€æœç´¢ç­‰æ“ä½œï¼Œå°±å¯èƒ½å‘ç”Ÿè¿™ç§æƒ…å†µã€‚

æ‚¨å¯ä»¥åˆ©ç”¨ä»`useFetch()`ç»„åˆå¼è¿”å›çš„`refresh()`æ–¹æ³•ä½¿ç”¨ä¸åŒçš„æŸ¥è¯¢å‚æ•°æ¥åˆ·æ–°æ•°æ®ï¼š

```vue
<script setup>
const page = ref(1);

const { data: users, pending, refresh, error } = await useFetch(() => `users?page=${page.value}&take=6`, { baseURL: config.API_BASE_URL }
);

function previous() {
  page.value--;
  refresh();
}

function next() {
  page.value++;
  refresh();
}
</script>
```

ä½¿è¿™ä¸ªå·¥ä½œçš„å…³é”®æ˜¯åœ¨æŸ¥è¯¢å‚æ•°å‘ç”Ÿå˜åŒ–æ—¶è°ƒç”¨ä»`useFetch()`ç»„åˆå¼è¿”å›çš„`refresh()`æ–¹æ³•ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œ`refresh()`å°†å–æ¶ˆä»»ä½•æŒ‚èµ·çš„è¯·æ±‚ï¼›å®ƒä»¬çš„ç»“æœä¸ä¼šæ›´æ–°æ•°æ®æˆ–æŒ‚èµ·çŠ¶æ€ã€‚ä»»ä½•å…ˆå‰ç­‰å¾…çš„Promiseéƒ½ä¸ä¼šåœ¨æ–°è¯·æ±‚è§£å†³ä¹‹å‰è§£å†³ã€‚æ‚¨å¯ä»¥é€šè¿‡è®¾ç½®`dedupe`é€‰é¡¹æ¥é˜²æ­¢è¿™ç§è¡Œä¸ºï¼Œå¦‚æœæœ‰æ­£åœ¨æ‰§è¡Œçš„è¯·æ±‚ï¼Œåˆ™ä¼šè¿”å›è¯¥è¯·æ±‚çš„Promiseã€‚

```js
refresh({ dedupe: true })
```

### `refreshNuxtData`

ä½¿`useAsyncData`ã€`useLazyAsyncData`ã€`useFetch`å’Œ`useLazyFetch`çš„ç¼“å­˜å¤±æ•ˆå¹¶è§¦å‘é‡æ–°è·å–ã€‚

å¦‚æœæ‚¨æƒ³åˆ·æ–°å½“å‰é¡µé¢çš„æ‰€æœ‰æ•°æ®è·å–ï¼Œåˆ™æ­¤æ–¹æ³•å¾ˆæœ‰ç”¨ã€‚

::ReadMore{link="/docs/api/utils/refresh-nuxt-data"}
::

#### ç¤ºä¾‹

```vue
<template>
  <div>
    {{ pending ? 'Loading' : count }}
  </div>
  <button @click="refresh">Refresh</button>
</template>

<script setup>
const { pending, data: count } = useLazyAsyncData('count', () => $fetch('/api/count'))

const refresh = () => refreshNuxtData('count')
</script>
```

### `clearNuxtData`

åˆ é™¤`useAsyncData`å’Œ`useFetch`çš„ç¼“å­˜æ•°æ®ã€é”™è¯¯çŠ¶æ€å’ŒæŒ‚èµ·çš„Promiseã€‚

å¦‚æœæ‚¨æƒ³ä½¿å¦ä¸€ä¸ªé¡µé¢çš„æ•°æ®è·å–å¤±æ•ˆï¼Œåˆ™æ­¤æ–¹æ³•å¾ˆæœ‰ç”¨ã€‚


::ReadMore{link="/docs/api/utils/clear-nuxt-data"}
::

## Options API æ”¯æŒ

Nuxt 3 æä¾›äº†ä¸€ç§åœ¨ Options API ä¸­æ‰§è¡Œ `asyncData` è·å–çš„æ–¹å¼ã€‚ä¸ºäº†ä½¿å…¶å·¥ä½œï¼Œæ‚¨å¿…é¡»å°†ç»„ä»¶å®šä¹‰åŒ…è£…åœ¨ `defineNuxtComponent` ä¸­ã€‚

```vue
<script>
export default defineNuxtComponent({
  fetchKey: 'hello',
  async asyncData () {
    return {
      hello: await $fetch('/api/hello')
    }
  }
})
</script>
```

::Alert
åœ¨ Nuxt 3 ä¸­ï¼Œä½¿ç”¨ `<script setup lang="ts">` å£°æ˜ Vue ç»„ä»¶æ˜¯æ¨èçš„æ–¹å¼ã€‚
::

::ReadMore{link="/docs/api/utils/define-nuxt-component"}
::

## åŒæ„çš„ `fetch` å’Œ `$fetch`


å½“æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­è°ƒç”¨ `fetch` æ—¶ï¼Œç”¨æˆ·çš„ headerï¼ˆå¦‚ `cookie`ï¼‰å°†ç›´æ¥å‘é€åˆ° APIã€‚ä½†åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“æœŸé—´ï¼Œç”±äº `fetch` è¯·æ±‚åœ¨æœåŠ¡å™¨å†…éƒ¨å‘ç”Ÿï¼Œå› æ­¤ä¸åŒ…æ‹¬ç”¨æˆ·çš„æµè§ˆå™¨ cookieï¼Œä¹Ÿä¸ä¼šä¼ é€’æ¥è‡ª fetch å“åº”çš„ cookieã€‚

::ReadMore{link="/docs/api/utils/dollarfetch"}
::

### ç¤ºä¾‹ï¼šå°†å®¢æˆ·ç«¯ Header ä¼ é€’ç»™ API

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ [`useRequestHeaders`](/api/composables/use-request-headers) æ¥è®¿é—®å¹¶ä»£ç†ä»æœåŠ¡å™¨å‘ API ä¼ é€’ Cookieã€‚

ä¸‹é¢çš„ç¤ºä¾‹å°†è¯·æ±‚å¤´æ·»åŠ åˆ° isomorphic `$fetch` è°ƒç”¨ä¸­ï¼Œä»¥ç¡®ä¿ API ç«¯ç‚¹å¯ä»¥è®¿é—®æœ€åˆç”±ç”¨æˆ·å‘é€çš„ç›¸åŒ `cookie` å¤´ã€‚

```vue
<script setup>
const headers = useRequestHeaders(['cookie'])
const { data } = await useFetch('/api/me', { headers })
</script>
```

::alert{type="warning"}
è¯·æ³¨æ„ï¼Œåœ¨å°†æ ‡å¤´ä»£ç†åˆ°å¤–éƒ¨APIä¹‹å‰è¦éå¸¸å°å¿ƒï¼Œå¹¶åªåŒ…æ‹¬æ‚¨éœ€è¦çš„æ ‡å¤´ã€‚å¹¶éæ‰€æœ‰æ ‡å¤´éƒ½æ˜¯å®‰å…¨çš„ï¼Œå¯èƒ½ä¼šå¼•å…¥ä¸éœ€è¦çš„è¡Œä¸ºã€‚ä»¥ä¸‹æ˜¯ä¸åº”ä»£ç†çš„å¸¸è§æ ‡å¤´åˆ—è¡¨ï¼š

* `host`, `accept`
* `content-length`, `content-md5`, `content-type`
* `x-forwarded-host`, `x-forwarded-port`, `x-forwarded-proto`
* `cf-connecting-ip`, `cf-ray`
::

### ç¤ºä¾‹ï¼šåœ¨ SSR å“åº”ä¸­ä¼ é€’æ¥è‡ªæœåŠ¡å™¨ç«¯ API è°ƒç”¨çš„ Cookie

å¦‚æœä½ æƒ³æŠŠ cookies ä»ä¸€ä¸ªå†…éƒ¨è¯·æ±‚ä»£ç†åˆ°å®¢æˆ·ç«¯ï¼Œä½ éœ€è¦è‡ªè¡Œå¤„ç†è¿™ä¸ªé—®é¢˜ã€‚

```ts [composables/fetch.ts]
export const fetchWithCookie = async (event: H3Event, url: string) => {
  const res = await $fetch.raw(url)
  const cookies = (res.headers.get('set-cookie') || '').split(',')
  for (const cookie of cookies) {
    appendHeader(event, 'set-cookie', cookie)
  }
  return res._data
}
```

```vue
<script setup lang="ts">
// This composable will automatically pass cookies to the client
const event = useRequestEvent()
const result = await fetchWithCookie(event, '/api/with-cookie')
onMounted(() => console.log(document.cookie))
</script>
```

## æœ€ä½³å®è·µ

è¿™äº›å¯ç»„åˆå‡½æ•°è¿”å›çš„æ•°æ®å°†å­˜å‚¨åœ¨é¡µé¢è´Ÿè½½ä¸­ã€‚è¿™æ„å‘³ç€é™¤äº†åœ¨ç»„ä»¶ä¸­ä½¿ç”¨çš„é”®ä¹‹å¤–ï¼Œè¿”å›çš„æ¯ä¸ªé”®éƒ½å°†æ·»åŠ åˆ°è´Ÿè½½ä¸­

::alert{icon=ğŸ‘‰}
**æˆ‘ä»¬å¼ºçƒˆå»ºè®®æ‚¨åªé€‰æ‹©åœ¨ç»„ä»¶ä¸­ä½¿ç”¨çš„é”®ã€‚**
::

å‡è®¾`/api/mountains/everest`è¿”å›ä»¥ä¸‹å¯¹è±¡ï¼š

```json
{
  "title": "Mount Everest",
  "description": "Mount Everest is Earth's highest mountain above sea level, located in the Mahalangur Himal sub-range of the Himalayas. The Chinaâ€“Nepal border runs across its summit point",
  "height": "8,848 m",
  "countries": [
    "China",
    "Nepal"
  ],
  "continent": "Asia",
  "image": "https://upload.wikimedia.org/wikipedia/commons/thumb/f/f6/Everest_kalapatthar.jpg/600px-Everest_kalapatthar.jpg"
}
```

å¦‚æœæ‚¨è®¡åˆ’ä»…åœ¨ç»„ä»¶ä¸­ä½¿ç”¨`title`å’Œ`description`ï¼Œåˆ™å¯ä»¥é€šè¿‡é“¾æ¥`$fetch`æˆ–`pick`é€‰é¡¹æ¥é€‰æ‹©é”®ï¼š

```vue
<script setup>
const { data: mountain } = await useFetch('/api/mountains/everest', { pick: ['title', 'description'] })
</script>

<template>
  <h1>{{ mountain.title }}</h1>
  <p>{{ mountain.description }}</p>
</template>
```

## ä½¿ç”¨ Async Setup

å¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨ `async setup()`ï¼Œé‚£ä¹ˆå½“å‰ç»„ä»¶å®ä¾‹å°†åœ¨ç¬¬ä¸€ä¸ª `await` åä¸¢å¤±ã€‚ï¼ˆè¿™æ˜¯ Vue 3 çš„é™åˆ¶ã€‚ï¼‰å¦‚æœæ‚¨æƒ³ä½¿ç”¨å¤šä¸ª async æ“ä½œï¼Œæ¯”å¦‚å¤šä¸ª `useFetch` è°ƒç”¨ï¼Œé‚£ä¹ˆæ‚¨éœ€è¦åœ¨ setup çš„ç»“å°¾ä¸€èµ·ä½¿ç”¨å®ƒä»¬æˆ–ä½¿ç”¨ `<script setup>`ã€‚

::alert{icon=ğŸ‘‰}
æ¨èä½¿ç”¨ `<script setup>`ï¼Œå› ä¸ºå®ƒæ¶ˆé™¤äº†ä½¿ç”¨é¡¶çº§ await çš„é™åˆ¶ã€‚[äº†è§£æ›´å¤š](https://vuejs.org/api/sfc-script-setup.html#top-level-await)
::

```vue
<script>
export default defineComponent({
  async setup() {
    const [{ data: organization }, { data: repos }] = await Promise.all([
      useFetch(`https://api.github.com/orgs/nuxt`),
      useFetch(`https://api.github.com/orgs/nuxt/repos`)
    ])

    return {
      organization,
      repos
    }
  }
})
</script>

<template>
  <header>
    <h1>{{ organization.login }}</h1>
    <p>{{ organization.description }}</p>
  </header>
</template>
```

## ç›´æ¥è°ƒç”¨ API Endpoint

æœ‰äº›æƒ…å†µä¸‹ï¼Œæ‚¨å¯èƒ½éœ€è¦ç›´æ¥è°ƒç”¨ APIã€‚ Nuxt 3 æä¾›äº†ä¸€ä¸ªå…¨å±€å¯ç”¨çš„ `$fetch` æ–¹æ³•ï¼Œä½¿ç”¨ [unjs/ofetch](https://github.com/unjs/ofetch)ï¼ˆé™¤äº† `fetch`ï¼‰ä¸ [Fetch API](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch) å…·æœ‰ç›¸åŒçš„ APIã€‚

ä½¿ç”¨ `$fetch` æœ‰è®¸å¤šå¥½å¤„ï¼ŒåŒ…æ‹¬ï¼š

å¦‚æœå®ƒåœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œå®ƒå°†â€œæ™ºèƒ½åœ°â€è¿›è¡Œç›´æ¥ API è°ƒç”¨ï¼Œæˆ–è€…å¦‚æœå®ƒåœ¨å®¢æˆ·ç«¯ä¸Šè¿è¡Œï¼Œåˆ™è¿›è¡Œå¯¹æ‚¨çš„ API çš„å®¢æˆ·ç«¯è°ƒç”¨ã€‚ï¼ˆå®ƒä¹Ÿå¯ä»¥å¤„ç†è°ƒç”¨ç¬¬ä¸‰æ–¹ APIã€‚ï¼‰

æ­¤å¤–ï¼Œå®ƒè¿˜æä¾›äº†ä¸€äº›æ–¹ä¾¿çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬è‡ªåŠ¨è§£æå“åº”å’Œå­—ç¬¦ä¸²åŒ–æ•°æ®ã€‚
